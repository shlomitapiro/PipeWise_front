<Window x:Class="PipeWiseClient.Windows.PipelinePickerWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="בחר פייפליין שמור"
        Height="520"
        Width="780"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResize"
        ShowInTaskbar="False"
        FlowDirection="RightToLeft">

  <DockPanel Margin="12">

    <!-- סרגל עליון: כותרת + חיפוש + רענון -->
    <Border DockPanel.Dock="Top"
            Background="#F8F9FA"
            BorderBrush="#E1E5E9"
            BorderThickness="1"
            CornerRadius="6"
            Padding="10"
            Margin="0,0,0,10">
      <Grid>
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*"/>
          <ColumnDefinition Width="Auto"/>
          <ColumnDefinition Width="Auto"/>
        </Grid.ColumnDefinitions>

        <!-- חיפוש -->
        <Grid Grid.Column="0" Margin="0,0,10,0">
          <TextBox x:Name="SearchBox"
                   Height="34"
                   VerticalContentAlignment="Center"
                   KeyDown="SearchBox_KeyDown"
                   ToolTip="הקלד מילת חיפוש (שם/תיאור) ולחץ Enter"/>
          <!-- פלייסהולדר פשוט -->
          <TextBlock Text="חפש לפי שם או תיאור…"
                     Margin="8,0,0,0"
                     Foreground="#9AA0A6"
                     IsHitTestVisible="False"
                     VerticalAlignment="Center">
            <TextBlock.Style>
              <Style TargetType="TextBlock">
                <Setter Property="Visibility" Value="Collapsed"/>
                <Style.Triggers>
                  <DataTrigger Binding="{Binding Text, ElementName=SearchBox}" Value="">
                    <Setter Property="Visibility" Value="Visible"/>
                  </DataTrigger>
                </Style.Triggers>
              </Style>
            </TextBlock.Style>
          </TextBlock>
        </Grid>

        <!-- רענון -->
        <Button Grid.Column="1"
                Content="רענן"
                Margin="0,0,8,0"
                Click="Refresh_Click"
                Height="34"
                MinWidth="100"/>

        <!-- טיפ קטן -->
        <TextBlock Grid.Column="2"
                   VerticalAlignment="Center"
                   Foreground="#6C757D"
                   FontSize="11"
                   Text="טיפ: אפשר למחוק פריט עם מקש Delete או מתפריט ימני"/>
      </Grid>
    </Border>

    <!-- רשימת פייפליינים -->
    <Border BorderBrush="#E1E5E9"
            BorderThickness="1"
            CornerRadius="6"
            Padding="0">
      <Grid>
        <Grid.RowDefinitions>
          <RowDefinition Height="*"/>
          <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <ListView x:Name="PipelinesList"
                  Grid.Row="0"
                  Margin="0"
                  SelectionMode="Single"
                  MouseDoubleClick="PipelinesList_MouseDoubleClick"
                  KeyDown="PipelinesList_KeyDown">
          <ListView.View>
            <GridView AllowsColumnReorder="True">
              <GridViewColumn Header="שם" DisplayMemberBinding="{Binding name}" Width="260"/>
              <GridViewColumn Header="תיאור" DisplayMemberBinding="{Binding description}" Width="360"/>
              <GridViewColumn Header="עודכן" DisplayMemberBinding="{Binding updated_at}" Width="120"/>
            </GridView>
          </ListView.View>

          <!-- תפריט הקשר -->
          <ListView.ContextMenu>
            <ContextMenu>
              <MenuItem Header="הרץ פייפליין" Click="RunSelected_Click"/>
              <MenuItem Header="מחק" Click="DeleteSelected_Click"/>
            </ContextMenu>
          </ListView.ContextMenu>
        </ListView>

        <!-- שורת כפתורים תחתונה -->
        <DockPanel Grid.Row="1" Margin="8" LastChildFill="False">
          <StackPanel Orientation="Horizontal" DockPanel.Dock="Left">
            <Button Content="בחר"
                    Click="Choose_Click"
                    Style="{StaticResource Btn.ChoosePipeline}"
                    Tag="&#xE8FB;"
                    MinWidth="140"
                    Height="40"
                    Margin="0,0,8,0"/>
            <Button Content="מחק"
                    Click="DeleteSelected_Click"
                    Style="{StaticResource Btn.Reset}"
                    Tag="&#xE74D;"
                    MinWidth="120"
                    Height="40"/>
          </StackPanel>

          <StackPanel Orientation="Horizontal" DockPanel.Dock="Right">
            <Button Content="ביטול"
                    IsCancel="True"
                    MinWidth="120"
                    Height="40"/>
          </StackPanel>
        </DockPanel>
      </Grid>
    </Border>

  </DockPanel>
</Window>
